<!DOCTYPE html>
<html>
<title>SchoolCompare</title>


<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript">
        var map;
        var markers = [];
        var lastinfowindow;
        var locIndex;

        //Polyfill function Credit: MDN
        if (!Array.prototype.forEach) {
            Array.prototype.forEach = function(fn, scope) {
                for (var i = 0, len = this.length; i < len; ++i) {
                    fn.call(scope, this[i], i, this);
                }
            }
        }

        /*
        Temporary data array
        */
        var data = [
            {
                address: '457 Liverpool Road, Strathfield NSW 2135',
                title: 'Strathfield South Public school',
                type: 'gov',

            },
            {
                address: 'Francis St, Strathfield NSW 2135',
                title: 'St Patrick\'s College Strathfield',
                type: 'nongov'
            },
            {
                "_id": 8151,
                "title": "Homebush Boys High School",
                "address": "Bridge Rd, Homebush NSW 2140",
                "suburb": "Homebush ",
                "postcode": 2140,
                "students": 1137,
                "selective": "Not Selective",
                "gender": "Boys",
                "attendance_rates": {
                    "2012": "94.1",
                    "2014": "95.1",
                    "2017": "91.9",
                    "2015": "92.8",
                    "2016": "93",
                    "2011": "94.7",
                    "2013": "94.1"
                },
                "selective_entry_scores": {},
                "enrollments": {
                    "2016": "1159",
                    "2015": "1134.544",
                    "2014": "1155.088",
                    "2017": "1128"
                }
            },
            {
                "_id": 8169,
                "title": "Strathfield Girls High School",
                "address": '116 Albert Rd, Strathfield NSW 2135',
                "postcode": 2135,
                "students": 1149,
                "selective": "Not Selective",
                "gender": "Girls",
                "attendance_rates": {
                    "2012": "95.5",
                    "2014": "97",
                    "2017": "96.4",
                    "2015": "96.2",
                    "2016": "96.3",
                    "2011": "95.3",
                    "2013": "96.6"
                },
                "selective_entry_scores": {},
                "enrollments": {
                    "2016": "1129.656",
                    "2015": "1129.555",
                    "2014": "1118.896",
                    "2017": "1062.416"
                }
            }

        ];

        function initialize() {
            var mapStyles = [
                {
                    "featureType": "landscape.man_made",
                    "elementType": "all",
                    "stylers": [{
                            "visibility": "on"
                        },
                        {
                            "color": "#eeeeee"
                        }
                    ]
                },
                {
                    "featureType": "landscape.natural.landcover",
                    "elementType": "all",
                    "stylers": [{
                            "visibility": "on"
                        },
                        {
                            "color": "#7fb298"
                        }
                    ]
                },
                {
                    "featureType": "landscape.natural.terrain",
                    "elementType": "all",
                    "stylers": [{
                            "visibility": "on"
                        },
                        {
                            "color": "#a5d3bb"
                        }
                    ]
                },
                {
                    "featureType": "poi",
                    "elementType": "labels.text.fill",
                    "stylers": [{
                            "visibility": "on"
                        },
                        {
                            "color": "#444444"
                        }
                    ]
                },
                {
                    "featureType": "poi",
                    "elementType": "labels.text.stroke",
                    "stylers": [{
                            "visibility": "off"
                        },
                        {
                            "color": "#ffffff"
                        }
                    ]
                },
                {
                    "featureType": "poi.park",
                    "elementType": "geometry",
                    "stylers": [{
                            "visibility": "on"
                        },
                        {
                            "color": "#c5dac3"
                        }
                    ]
                },
                {
                    "featureType": "road.highway",
                    "elementType": "geometry.fill",
                    "stylers": [{
                            "visibility": "on"
                        },
                        {
                            "color": "#eeeeee"
                        }
                    ]
                },
                {
                    "featureType": "road.highway",
                    "elementType": "geometry.stroke",
                    "stylers": [{
                            "visibility": "on"
                        },
                        {
                            "color": "#ffffff"
                        }
                    ]
                },
                {
                    "featureType": "road.highway",
                    "elementType": "labels.text.fill",
                    "stylers": [{
                            "visibility": "on"
                        },
                        {
                            "color": "#444444"
                        }
                    ]
                },
                {
                    "featureType": "transit",
                    "elementType": "geometry.fill",
                    "stylers": [{
                            "visibility": "on"
                        },
                        {
                            "color": "#999999"
                        }
                    ]
                },
                {
                    "featureType": "transit",
                    "elementType": "geometry.stroke",
                    "stylers": [{
                            "visibility": "on"
                        },
                        {
                            "color": "#444444"
                        }
                    ]
                },
                {
                    "featureType": "transit",
                    "elementType": "labels.text.fill",
                    "stylers": [{
                        "color": "#444444"
                    }]
                },
                {
                    "featureType": "water",
                    "elementType": "all",
                    "stylers": [{
                            "visibility": "on"
                        },
                        {
                            "color": "#7e9fd1"
                        }
                    ]
                }
            ];
            var latlng = new google.maps.LatLng(-33.8724445, 151.0916209);
            var myOptions = {
                zoom: 14,
                center: latlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
            map.set('styles', mapStyles);

            geocoder = new google.maps.Geocoder();

            data.forEach(function(mapData, idx) {
                geocoder.geocode({
                    'address': mapData.address
                }, function(results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        var marker = new google.maps.Marker({
                            map: map,
                            position: results[0].geometry.location,
                            title: mapData.title,
                            icon: "resources/logo_xs.png"
                        });
                        var contentHtml = "<div style='width:300px;height:200px'><h5>" + mapData.title + "</h5>" + mapData.address + "<br><a href='\/profile.html?id=" + mapData._id + "'>Details</a></div>";
                        var infowindow = new google.maps.InfoWindow({
                            content: contentHtml
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            for (var i = 0; i < markers.length; i++) {
                                markers[i].infowindow.close();
                            }
                            infowindow.open(map, marker);
                        });
                        marker.locid = idx + 1;
                        marker.infowindow = infowindow;
                        markers[markers.length] = marker;

                        var sideHtml = '<p class="loc card" data-locid="' + marker.locid + '"><b>' + mapData.title + '</b>';
                        sideHtml += mapData.address + '</p>';
                        $("#locs").append(sideHtml);

                        //todo
                        if (markers.length == data.length) doFilter();

                    } else {
                        //alert("Geocode was not successful for the following reason: " + status);
                    }
                });

            });

            $(document).on("click", ".loc", function() {
                var thisloc = $(this).data("locid");
                for (var i = 0; i < markers.length; i++) {
                    if (markers[i].locid == thisloc) {
                        //get the latlong
                        if (lastinfowindow instanceof google.maps.InfoWindow) {
                            lastinfowindow.close();
                        }
                        map.panTo(markers[i].getPosition());
                        markers[i].infowindow.open(map, markers[i]);
                        lastinfowindow = markers[i].infowindow;
                    }
                }
            });

            /*
            Filter function (add more to taste)
            */

            function doFilter() {
                if (!locIndex) {
                    locIndex = {};
                    //I reverse index markers to figure out the position of loc to marker index
                    for (var x = 0, len = markers.length; x < len; x++) {
                        locIndex[markers[x].locid] = x;
                    }
                }

                //what's checked?
                var checked = $("input[type=checkbox]:checked");
                var selTypes = [];
                for (var i = 0, len = checked.length; i < len; i++) {
                    selTypes.push($(checked[i]).val());
                }
                for (var i = 0, len = data.length; i < len; i++) {
                    var sideDom = "p.loc[data-locid=" + (i + 1) + "]";

                    //Only hide if length != 0
                    if (checked.length != 0 && selTypes.indexOf(data[i].type) < 0) {
                        $(sideDom).hide();
                        markers[locIndex[i + 1]].setVisible(false);
                    } else {
                        $(sideDom).show();
                        markers[locIndex[i + 1]].setVisible(true);
                    }
                }
            }

            $(document).on("click", "input[type=checkbox]", doFilter);

        }

    </script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" crossorigin="anonymous" href="http://meta-kage.kakaocdn.net/dn/osa/blog/assets/fonts/Kakao.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/style.css" />

</head>

<body>
    <div class="row">
        <div class="col-sm-4 sidebar">
            <nav class="navbar navbar-expand-md bg-dark navbar-dark">
                <a class="navbar-brand" href="/home.html"><img src="/resources/logo_sm.png" width="50px"/> SchoolCompare</a>
                <!--
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>
                <div class="collapse navbar-collapse" id="collapsibleNavbar">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="#">Home</a>
                        </li>
                    </ul>
                </div>
-->
            </nav>
            <div class="container">
                <div class="gap"></div>

                <!-- TODO: Search bar integration -->
                <form class="search" action="/action_page.php">
                    <input type="text" placeholder="Search..." name="search">
                    <button type="button"><i class="fa fa-search"></i></button>
                </form>
                <!--filter components-->
                <div class="gap"></div>
                <!--                <h2>Filters</h2>-->
                <div id="filterlist" class="collapse" style="margin-bottom: 20px;">
                    <p style="font-size:12px;  padding:15px; color: #7e9fd1">Check on all that apply. no checks will result every item available.</p>
                    <div id="form" style="display: inline-block;
   width: 100%;">
                        <div class="government">
                            <div class="filtercat">Government</div>
                            <label class="filters">
                            <span class="label"><input type="checkbox" name="Government" value="gov" />
                                  <span class="checkmark"></span> Government Schools</span>
                            </label>
                            <label class="filters">
                                <span class="label"><input type="checkbox" name="Non-Government" value="nongov" />
                                  <span class="checkmark"></span> Non-Government Schools</span>
                            </label>
                        </div>
                        <div class="slidecontainer">
                            <div class="filtercat">School Size</div>
                            <input type="range" min="100" max="1000" value="500" step="50" class="slider" id="schoolSize">
                            <p><span id="schoolSizeVal">Val:</span></p>
                        </div>
                        <div class="slidecontainer">
                            <div class="filtercat">Attendance Rate</div>
                            <input type="range" min="80" max="100" value="0" class="slider" id="attendance">
                            <p><span id="attendanceVal">Val:</span>%</p>
                        </div>
                        <div class="slidecontainer">
                            <div class="filtercat">Minimum Selective School score</div>
                            <input type="range" min="0" max="300" value="200" step="5" class="slider" id="selective">
                            <p><span id="selectiveVal">Val:</span></p>
                        </div>
                        <button type="submit" class="btn btn-outline-primary btn-block">apply</button>
                        <div class="gap">&ensp;</div>

                    </div>
                </div>

                <!--Filter button TODO: Style-->
                <button type="button" class="btn btn-outline-info btn-block" data-toggle="collapse" data-target="#filterlist">Edit Filters</button>

                <!--Location list-->
                <div id="locs"></div>
            </div>
        </div>
        <div class="col-sm-8 maparea" style="padding-left:0">
            <div id="map_canvas">map area</div>
        </div>
    </div>


    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDsGuKG_rDmC4wfLvSrxsWb7HVLx59bi2Y&callback=initialize">


    </script>
    <script>
        var schoolSizeslider = document.getElementById("schoolSize");
        var schoolSizeoutput = document.getElementById("schoolSizeVal");
        schoolSizeoutput.innerHTML = schoolSizeslider.value; // Display the default slider value

        // Update the current slider value (each time you drag the slider handle)
        schoolSizeslider.oninput = function() {
            schoolSizeoutput.innerHTML = this.value;
        }

        var attendanceslider = document.getElementById("attendance");
        var attendanceoutput = document.getElementById("attendanceVal");
        attendanceoutput.innerHTML = attendanceslider.value; // Display the default slider value

        // Update the current slider value (each time you drag the slider handle)
        attendanceslider.oninput = function() {
            attendanceoutput.innerHTML = this.value;
        }

        var selectiveslider = document.getElementById("selective");
        var selectiveoutput = document.getElementById("selectiveVal");
        selectiveoutput.innerHTML = selectiveslider.value; // Display the default slider value

        // Update the current slider value (each time you drag the slider handle)
        selectiveslider.oninput = function() {
            selectiveoutput.innerHTML = this.value;
        }

    </script>
</body>

</html>
